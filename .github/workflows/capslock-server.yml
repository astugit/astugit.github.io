name: Capslock Server

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'How long to run the server (in minutes, max 360)'
        required: false
        default: '60'

permissions:
  contents: read

jobs:
  run-server:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - uses: actions/checkout@v3
        with:
          repository: nolenroyalty/global-capslock
          path: capslock


      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install fastapi uvicorn websockets

      - name: Run capslock server
        working-directory: capslock
        run: |
          echo "Starting capslock server..."
          echo "Server will run for ${{ github.event.inputs.duration }} minutes"
          timeout ${{ github.event.inputs.duration }}m python example-server.py || true
        env:
          PORT: 8000